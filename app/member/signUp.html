<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello World</title>
    <meta charset="utf-8">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">-->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="stylesheet" type="text/css" href="/assets/css/common.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/member.css">
    <link rel="stylesheet" type="text/css"  href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css"  href='http://fonts.googleapis.com/css?family=Varela+Round'>
    <link rel="stylesheet" type="text/css"  href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <script src="https://unpkg.com/vue"></script>
    <script type="text/javascript">
        /**
         * Handles the sign in button press.
         */
        function toggleSignIn() {
            if (firebase.auth().currentUser) {
                // [START signout]
                firebase.auth().signOut();
                // [END signout]
            } else {
                var email = document.getElementById('email').value;
                var password = document.getElementById('password').value;
                if (email.length < 4) {
                    alert('Please enter an email address.');
                    return;
                }
                if (password.length < 4) {
                    alert('Please enter a password.');
                    return;
                }
                // Sign in with email and pass.
                // [START authwithemail]
                firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
                    // Handle Errors here.
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    // [START_EXCLUDE]
                    if (errorCode === 'auth/wrong-password') {
                        alert('Wrong password.');
                    } else {
                        alert(errorMessage);
                    }
                    console.log(error);
                    document.getElementById('quickstart-sign-in').disabled = false;
                    // [END_EXCLUDE]
                });
                // [END authwithemail]
            }
            document.getElementById('quickstart-sign-in').disabled = true;
        }
        /**
         * 회원 가입을 처리한다.
         */
        function signUp(email, password, rePassword) {
            if (email.length < 4) {
                alert('이메일 주소를 확인 하여 주십시오.');
                return;
            }
            if (password.length < 4) {
                alert('비밀번호는 4자 이상입니다.');
                return;
            }
            if (password != rePassword) {
                alert('비밀번호를 확인 하여 주십시오.')
                return ;
            }
            // 회원 가입을 진행한다.
            firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                // [START_EXCLUDE]
                if (errorCode == 'auth/weak-password') {
                    alert('The password is too weak.');
                } else if(errorCode == 'auth/email-already_in_use'){
                    alert("비밀번호를 확인하여 주십시오.");
                } else {
                    alert(errorCode);
                }
                console.log(error);
            }).then(function(user){
                firebase.auth().currentUser.sendEmailVerification().then(function() {
                    // 인증메일 전송
                    alert("메일인증 후 로그인 가능합니다.")
                    location.href = "/";
                }).catch(function(error) {
                    alert(error.message);
                });
            });
        }
        function sendPasswordReset() {
            var email = document.getElementById('email').value;
            // [START sendpasswordemail]
            firebase.auth().sendPasswordResetEmail(email).then(function() {
                // Password Reset Email Sent!
                // [START_EXCLUDE]
                alert('Password Reset Email Sent!');
                // [END_EXCLUDE]
            }).catch(function(error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                // [START_EXCLUDE]
                if (errorCode == 'auth/invalid-email') {
                    alert(errorMessage);
                } else if (errorCode == 'auth/user-not-found') {
                    alert(errorMessage);
                }
                console.log(error);
                // [END_EXCLUDE]
            });
            // [END sendpasswordemail];
        }
        /**
         * initApp handles setting up UI event listeners and registering Firebase auth listeners:
         *  - firebase.auth().onAuthStateChanged: This listener is called when the user is signed in or
         *    out, and that is where we update the UI.
         */
        function initApp() {
            // Listening for auth state changes.
            // [START authstatelistener]
            // firebase.auth().onAuthStateChanged(function(user) {
            //     // [START_EXCLUDE silent]
            //     document.getElementById('quickstart-verify-email').disabled = true;
            //     // [END_EXCLUDE]
            //     if (user) {
            //         // User is signed in.
            //         var displayName = user.displayName;
            //         var email = user.email;
            //         var emailVerified = user.emailVerified;
            //         var photoURL = user.photoURL;
            //         var isAnonymous = user.isAnonymous;
            //         var uid = user.uid;
            //         var providerData = user.providerData;
            //         // [START_EXCLUDE]
            //         document.getElementById('quickstart-sign-in-status').textContent = 'Signed in';
            //         document.getElementById('quickstart-sign-in').textContent = 'Sign out';
            //         document.getElementById('quickstart-account-details').textContent = JSON.stringify(user, null, '  ');
            //         if (!emailVerified) {
            //             document.getElementById('quickstart-verify-email').disabled = false;
            //         }
            //         // [END_EXCLUDE]
            //     } else {
            //         // User is signed out.
            //         // [START_EXCLUDE]
            //         document.getElementById('quickstart-sign-in-status').textContent = 'Signed out';
            //         document.getElementById('quickstart-sign-in').textContent = 'Sign in';
            //         document.getElementById('quickstart-account-details').textContent = 'null';
            //         // [END_EXCLUDE]
            //     }
            //     // [START_EXCLUDE silent]
            //     document.getElementById('quickstart-sign-in').disabled = false;
            //     // [END_EXCLUDE]
            // });
            // [END authstatelistener]
           // document.getElementById('quickstart-sign-in').addEventListener('click', toggleSignIn, false);
           // document.getElementById('quickstart-sign-up').addEventListener('click', handleSignUp, false);
           // document.getElementById('quickstart-verify-email').addEventListener('click', sendEmailVerification, false);
           // document.getElementById('quickstart-password-reset').addEventListener('click', sendPasswordReset, false);
        }
        window.onload = function() {
            initApp();
        };
    </script>
</head>
<body class="container bg">
<nav class="navbar navbar-expand-md navbar-dark ">
    <a class="navbar-brand" href="#">회원가입</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
</nav>
<main role="main" class="container" id="regForm">
    <div class="jumbotron">
        <div class="container">
            <h1 class="display-5">환영합니다.</h1>
            <div class="form-group">
                <label for="email">email :</label>
                <input type="text" class="form-control" id="email" placeholder="email을 입력하여 주십시오." ref="email">
            </div>
            <div class="form-group">
                <label for="password">비밀번호 : </label>
                <input type="password" class="form-control" id="password" placeholder="비밀번호를 입력하여 주십시오" ref="password">
            </div>
            <div class="form-group">
                <label for="password">비밀번호 확인: </label>
                <input type="password" class="form-control" id="password_re" placeholder="비밀번호를 다시 입력하여 주십시오." ref="re_password">
            </div>
            <div class="form-group">
                <button type="button" class="btn btn-success pull-right" v-on:click="onRegister">가입완료</button>
            </div>
        </div>
    </div>
</main>
<script src="https://www.gstatic.com/firebasejs/4.9.0/firebase.js"></script>
<script src="/assets/libs/auth.js"></script>
<script>
    var regForm = new Vue({
        el : "#regForm",
        methods : {
            onRegister : function() {
                signUp(this.$refs.email.value, this.$refs.password.value, this.$refs.re_password.value);
            }
        }
    })
</script>
</body>
</html>